<!DOCTYPE html><html lang="es"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Simula tu Financiamiento con Sefar Universal</title><link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Montserrat:wght@500&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-p8Jdzz2cYUK5GckX1c0Yc6XJyl4CxjOboPnBVV5M4pufz1V2bTEVvYtOHr1Jt5rMFE9WPrBB88g3lIsA+Zp2Kg==" crossorigin="anonymous" referrerpolicy="no-referrer"><style>:root{--background:#4d4d4d;--background-calculator:#f5f5f5;--text-color:#ffffff;--title-color:#000000;--input-background:#ffffff;--input-border:#ced4da;--input-text:#333333;--button-background:#1ABC9C;--button-hover:#16A085;--button-active:#148F77;--button-clear:#E74C3C;--button-clear-hover:#C0392B;--button-clear-active:#A93226;--slider-track:#ced4da;--slider-thumb:#1ABC9C;--cuotas-display:#000000;--result-background:#e0e0e0;--result-text:#3498DB;--box-shadow:rgba(0, 0, 0, 0.05);--transition-speed:0.3s;--font-primary:'Roboto',sans-serif;--font-secondary:'Montserrat',sans-serif;--select-arrow:url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="%231ABC9C"><polygon points="0,0 20,0 10,10" /></svg>')}.dark-theme{--background:#1a1a1a;--background-calculator:#2c2c2c;--text-color:#e0e0e0;--title-color:#ffffff;--input-background:#3a3a3a;--input-border:#555555;--input-text:#e0e0e0;--slider-track:#555555;--slider-thumb:#1ABC9C;--cuotas-display:#e0e0e0;--result-background:#3a3a3a;--select-arrow:url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="%23e0e0e0"><polygon points="0,0 20,0 10,10" /></svg>')}*{margin:0;padding:0;box-sizing:border-box}body{font-family:var(--font-primary);background:var(--background);display:flex;justify-content:center;align-items:center;flex-direction:column;min-height:100vh;transition:background var(--transition-speed)}.logo-container{margin-bottom:30px;text-align:center}.logo-container img{max-width:400px;width:100%;height:auto}.calculator{background-color:var(--background-calculator);padding:40px 50px;border-radius:16px;box-shadow:0 10px 25px var(--box-shadow);max-width:800px;width:100%;animation:fadeIn .8s ease-in-out;position:relative;transition:background-color var(--transition-speed),box-shadow var(--transition-speed)}@keyframes fadeIn{from{opacity:0;transform:translateY(-30px)}to{opacity:1;transform:translateY(0)}}.theme-toggle{position:absolute;top:20px;right:20px;background:0 0;border:none;cursor:pointer;font-size:1.8em;color:var(--text-color);transition:color var(--transition-speed)}.theme-toggle:focus{outline:0}.calculator h2{text-align:center;margin-bottom:30px;color:var(--title-color);font-family:var(--font-secondary);font-size:2em;letter-spacing:1px;position:relative}.calculator h2::after{content:'';position:absolute;width:50px;height:5px;background:var(--button-background);bottom:-10px;left:50%;transform:translateX(-50%);border-radius:5px}.input-group{margin-bottom:25px}.input-group label{display:block;margin-bottom:10px;color:var(--input-text);font-weight:600;font-size:1.1em}.input-group input,.input-group select{width:100%;padding:12px 20px;border:1px solid var(--input-border);border-radius:8px;font-size:1em;background-color:var(--input-background);color:var(--input-text);transition:border-color var(--transition-speed),background-color var(--transition-speed),color var(--transition-speed);outline:0}.input-group input:focus,.input-group select:focus{border-color:var(--button-background);box-shadow:0 0 5px var(--button-background)}.input-group select{appearance:none;background-image:var(--select-arrow);background-repeat:no-repeat;background-position:right 15px center;background-size:10px;cursor:pointer;padding-right:40px}.slider-container input[type=range]{width:100%;-webkit-appearance:none;background:0 0;height:12px;border-radius:5px;outline:0;margin:15px 0;transition:background .3s ease}.slider-container input[type=range]:focus{box-shadow:0 0 5px rgba(0,0,0,.3)}.slider-container input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:26px;height:26px;background:var(--slider-thumb);cursor:pointer;border-radius:50%;border:2px solid var(--background-calculator);box-shadow:0 2px 5px rgba(0,0,0,.3);transition:background var(--transition-speed),transform .2s}.slider-container input[type=range]::-webkit-slider-thumb:hover{background:var(--button-hover);transform:scale(1.1)}.slider-container input[type=range]::-moz-range-thumb{width:26px;height:26px;background:var(--slider-thumb);cursor:pointer;border-radius:50%;border:2px solid var(--background-calculator);box-shadow:0 2px 5px rgba(0,0,0,.3);transition:background var(--transition-speed),transform .2s}.slider-container input[type=range]::-moz-range-thumb:hover{background:var(--button-hover);transform:scale(1.1)}.slider-container input[type=range]::-moz-range-track,.slider-container input[type=range]::-webkit-slider-runnable-track{height:12px;background:var(--slider-track);border-radius:5px}.cuotas-display{text-align:center;margin-bottom:25px;font-size:1.2em;color:var(--cuotas-display);font-weight:600}.button-group{display:flex;justify-content:space-between;gap:15px;margin-top:15px}.button-group button{flex:1;padding:14px;border:none;color:#fff;font-size:1.1em;font-weight:600;border-radius:8px;cursor:pointer;transition:background-color var(--transition-speed),transform .2s,box-shadow var(--transition-speed);display:flex;align-items:center;justify-content:center}.calculate-button{background-color:var(--button-background)}.clear-button{background-color:var(--button-clear)}.button-group button:hover{transform:translateY(-3px);box-shadow:0 5px 15px rgba(0,0,0,.2)}.button-group button:active{transform:translateY(0);box-shadow:none}.result{text-align:center;margin-top:30px;font-size:1.2em;color:var(--result-text);line-height:1.8;background:var(--result-background);padding:20px;border-radius:8px;box-shadow:0 5px 15px rgba(0,0,0,.1);transition:background-color var(--transition-speed),box-shadow var(--transition-speed);overflow-x:auto}.result table{width:100%;border-collapse:collapse;margin-top:20px}.result td,.result th{border:1px solid #ddd;padding:8px;text-align:center}.result th{background-color:var(--button-background);color:#fff}.result tr:nth-child(even){background-color:#f2f2f2}.result tr:hover{background-color:#ddd}.button-group button i{margin-right:8px;transition:transform .2s}.button-group button:hover i{transform:scale(1.2)}.export-button{margin-top:20px;padding:10px 20px;background-color:var(--button-background);color:#fff;border:none;border-radius:5px;cursor:pointer;transition:background-color var(--transition-speed);display:none;align-items:center;justify-content:center;margin-left:auto;margin-right:auto}.export-button:hover{background-color:var(--button-hover)}.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,.5);transition:opacity var(--transition-speed)}.modal-content{background-color:#fefefe;margin:25% auto;padding:20px;border:none;width:80%;max-width:400px;border-radius:8px;box-shadow:0 5px 15px rgba(0,0,0,.3);animation:fadeInModal .5s;text-align:center;position:relative}@keyframes fadeInModal{from{opacity:0;transform:translateY(-50px)}to{opacity:1;transform:translateY(0)}}.close-modal{color:#aaa;position:absolute;top:10px;right:20px;font-size:1.5em;font-weight:700;cursor:pointer}.close-modal:focus,.close-modal:hover{color:#000;text-decoration:none}.modal-message{margin-top:40px;font-size:1.1em;color:#333}.modal-button{margin-top:30px;display:flex;justify-content:center}.modal-button button{padding:10px 20px;background-color:var(--button-background);border:none;color:#fff;border-radius:5px;cursor:pointer;transition:background-color var(--transition-speed);font-size:1em}.modal-button button:hover{background-color:var(--button-hover)}@media (max-width:768px){.calculator{max-width:90%}}@media (max-width:480px){.calculator{padding:30px 25px}.calculator h2{font-size:1.6em}.input-group label,.slider-group label{font-size:1em}.input-group input,.input-group select,.slider-container input[type=range]{font-size:.95em}.button-group{flex-direction:column;gap:10px}.button-group button{font-size:1em;padding:12px}.result{font-size:1em;padding:15px}.theme-toggle{font-size:1.3em}.logo-container img{max-width:250px}.modal-content{width:90%;margin:35% auto}}</style></head><body><div class="logo-container"><img src="https://sefaruniversal.com/wp-content/uploads/2021/01/Logo-de-Sefar-Universal-nuevo-rediseno-pagina-web-Abogados-y-Genealogistas-letras-blancas.png" alt="Logo Sefar Universal"></div><div class="calculator"><button class="theme-toggle" id="theme-toggle" aria-label="Toggle Dark Mode"><i class="fas fa-moon"></i></button><h2>Simula tu Financiamiento con Sefar Universal</h2><div class="input-group"><label for="monto">Monto a Financiar:</label><input type="number" id="monto" min="1000" max="100000" step="100" placeholder="Ingrese el monto (€)" aria-label="Monto a Financiar" required></div><div class="input-group"><label for="servicio">Selecciona un Servicio:</label><select id="servicio" aria-label="Selecciona un Servicio"><option value="">-- Seleccione un servicio --</option><option value="8000">Nacionalidad Española por origen sefardi</option><option value="8000">Nacionalidad Portuguesa por origen sefardi</option><option value="8000">Nacionalidad Italiana por origen sefardi</option></select></div><div class="slider-group"><label for="cuotas">Número de Cuotas:</label><div class="slider-container"><input type="range" id="cuotas" min="3" max="12" value="5" aria-label="Número de Cuotas"></div></div><div class="cuotas-display">Cuotas:<span id="cuotas-value">5</span></div><div class="button-group"><button class="calculate-button" id="calculate-button"><i class="fas fa-calculator"></i>Calcular</button><button class="clear-button" id="clear-button"><i class="fas fa-trash-alt"></i>Borrar</button></div><div class="result" id="resultado" aria-live="polite"></div></div><div id="error-modal" class="modal" role="alertdialog" aria-labelledby="modal-message" aria-modal="true"><div class="modal-content"><span class="close-modal" id="close-modal" aria-label="Cerrar Modal">&times;</span><div class="modal-message" id="modal-message">Por favor, ingresa un monto válido.</div><div class="modal-button"><button id="close-button">Aceptar</button></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script><script>document.addEventListener('DOMContentLoaded', () => {
      const slider = document.getElementById('cuotas');
      const cuotasValue = document.getElementById('cuotas-value');
      const themeToggle = document.getElementById('theme-toggle');
      const body = document.body;
      const montoInput = document.getElementById('monto');
      const servicioSelect = document.getElementById('servicio');
      const calculateButton = document.getElementById('calculate-button');
      const clearButton = document.getElementById('clear-button');

      // Elementos del Modal
      const errorModal = document.getElementById('error-modal');
      const closeModal = document.getElementById('close-modal');
      const closeButton = document.getElementById('close-button');
      const modalMessage = document.getElementById('modal-message');

      // Actualizar el valor mostrado cuando se mueve el slider
      slider.addEventListener('input', function() {
        cuotasValue.textContent = this.value;
      });

      // Función para mostrar el modal de error
      function showErrorModal(message = 'Por favor, ingresa un monto válido.') {
        modalMessage.textContent = message;
        errorModal.style.display = 'block';
        closeButton.focus();
      }

      // Función para ocultar el modal de error
      function hideErrorModal() {
        errorModal.style.display = 'none';
        calculateButton.focus();
      }

      // Función para calcular la cuota mensual con interés simple  
      // Desglose:  
      //   Valor Cuota (€) = P / n  
      //   Interés por cuota = (P * r) / n  
      //   Total a Pagar (€) = Valor Cuota + Interés por cuota  
      // Se actualiza la tasa de interés a 10,1% (0.101) para obtener el Total a Pagar correcto.
      function calcularCuotaMensualSimple(P, r, n) {
        const capitalPorCuota = P / n;
        const interesPorCuota = (P * r) / n;
        return {
          valorCuota: capitalPorCuota,
          totalPagar: capitalPorCuota + interesPorCuota
        };
      }

      // Función para generar la tabla de amortización con 4 columnas:
      // "Cuota #", "Valor Cuota (€)", "% Administrativo y Seguro" y "Total a Pagar (€)"
      // Se utiliza la tasa de interés r para calcular el valor de la cuota y el total.
      function generarTablaAmortizacion(P, r, n) {
        const { valorCuota, totalPagar } = calcularCuotaMensualSimple(P, r, n);
        
        let tabla = `
          <h3>Tabla de Amortización</h3>
          <table id="tablaAmortizacion">
            <thead>
              <tr>
                <th>Cuota #</th>
                <th>Valor Cuota (€)</th>
                <th>% Administrativo y Seguro</th>
                <th>Total a Pagar (€)</th>
              </tr>
            </thead>
            <tbody>
        `;
        for (let i = 1; i <= n; i++) {
          tabla += `
            <tr>
              <td>${i}</td>
              <td>€${valorCuota.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
              <td>5%</td>
              <td>€${totalPagar.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
            </tr>
          `;
        }
        tabla += `
            </tbody>
          </table>
        `;
        return tabla;
      }

      // Función para exportar a PDF utilizando jsPDF y autoTable,
      // agregando además un mensaje adicional informativo.
      function exportarPDFConAutoTable() {
        console.log('Función exportarPDFConAutoTable ejecutada.');

        const elemento = document.getElementById('resultado');

        if (elemento.innerHTML.trim() === '') {
          alert('No hay contenido para exportar. Por favor, realiza un cálculo primero.');
          return;
        }

        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        const tituloElement = elemento.querySelector('h3');
        const tabla = elemento.querySelector('#tablaAmortizacion');

        if (!tituloElement || !tabla) {
          alert('No se encontró la tabla de amortización para exportar.');
          return;
        }

        const titulo = tituloElement.innerText;

        // Extraer encabezados
        const headers = [];
        tabla.querySelectorAll('thead th').forEach(th => {
          headers.push(th.innerText);
        });

        // Extraer datos
        const data = [];
        tabla.querySelectorAll('tbody tr').forEach(tr => {
          const row = [];
          tr.querySelectorAll('td').forEach(td => {
            row.push(td.innerText);
          });
          data.push(row);
        });

        doc.setFontSize(18);
        doc.text(titulo, 14, 22);

        doc.autoTable({
          startY: 30,
          head: [headers],
          body: data,
          styles: { fontSize: 10 },
          theme: 'striped',
          headStyles: { fillColor: [26, 188, 156] },
          margin: { top: 30 }
        });

        // Agregar mensaje informativo adicional en el PDF
        const finalY = doc.lastAutoTable.finalY || 50;
        doc.setFontSize(10);
        doc.text(
          "Esto es una simulación de financiamiento con Sefar Universal.\nPor favor, comuníquese con el dpto. encargado para mayor información.",
          14,
          finalY + 10,
          { maxWidth: 180 }
        );

        doc.save('tabla_amortizacion.pdf');
        console.log('PDF generado exitosamente.');
      }

      // Función para calcular el crédito y generar la tabla
      function calcularCredito() {
        const monto = parseFloat(montoInput.value);
        const cuotas = parseInt(slider.value, 10);
        const servicio = servicioSelect.value;

        // Validaciones
        if (isNaN(monto) || monto < parseFloat(montoInput.min) || monto > parseFloat(montoInput.max)) {
          showErrorModal('Por favor, ingresa un monto válido entre €1,000 y €100,000.');
          return;
        }
        if (servicio === "") {
          showErrorModal('Por favor, selecciona un servicio.');
          return;
        }
        if (isNaN(cuotas) || cuotas < 3 || cuotas > 12) {
          showErrorModal('Por favor, selecciona un número de cuotas válido entre 3 y 12.');
          return;
        }

        const tasaInteres = 0.101; // Actualizamos la tasa a 10,1%
        console.log(`Monto: ${monto}, Tasa de Interés: ${tasaInteres}, Cuotas: ${cuotas}`);
        
        // Generar la tabla de amortización con 4 columnas
        const tablaAmortizacion = generarTablaAmortizacion(monto, tasaInteres, cuotas);

        // Eliminar botón de exportación previo (si existe)
        const existingExportButton = document.getElementById('export-button');
        if (existingExportButton) {
          existingExportButton.remove();
        }

        // Actualizar el contenido del resultado
        document.getElementById('resultado').innerHTML = `
          ${tablaAmortizacion}
          <button id="export-button" class="export-button">
            <i class="fas fa-file-pdf"></i> Exportar a PDF
          </button>
        `;

        // Agregar el evento al botón de exportar
        const newExportButton = document.getElementById('export-button');
        newExportButton.style.display = 'flex';
        newExportButton.addEventListener('click', exportarPDFConAutoTable);
      }

      // Función para borrar datos
      function borrarDatos() {
        montoInput.value = '';
        servicioSelect.selectedIndex = 0;
        slider.value = 5;
        cuotasValue.textContent = 5;
        document.getElementById('resultado').innerHTML = '';
        // Buscar y ocultar el botón de exportar (si existe)
        const exportBtn = document.getElementById('export-button');
        if (exportBtn) {
          exportBtn.style.display = 'none';
        }
        montoInput.focus();
      }

      // Funcionalidad de modo oscuro
      function toggleTheme() {
        body.classList.toggle('dark-theme');
        const icon = themeToggle.querySelector('i');
        if (body.classList.contains('dark-theme')) {
          icon.classList.replace('fa-moon', 'fa-sun');
        } else {
          icon.classList.replace('fa-sun', 'fa-moon');
        }
        localStorage.setItem('theme', body.classList.contains('dark-theme') ? 'dark' : 'light');
      }

      // Cargar tema guardado
      (function loadTheme() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
          body.classList.add('dark-theme');
          const icon = themeToggle.querySelector('i');
          icon.classList.replace('fa-moon', 'fa-sun');
        }
      })();

      // Asignar eventos a los botones y modal
      calculateButton.addEventListener('click', calcularCredito);
      clearButton.addEventListener('click', borrarDatos);
      themeToggle.addEventListener('click', toggleTheme);
      closeModal.addEventListener('click', hideErrorModal);
      closeButton.addEventListener('click', hideErrorModal);

      window.addEventListener('click', function(event) {
        if (event.target === errorModal) {
          hideErrorModal();
        }
      });

      window.addEventListener('keydown', function(event) {
        if (event.key === 'Escape' && errorModal.style.display === 'block') {
          hideErrorModal();
        }
      });
    });</script></body></html>
